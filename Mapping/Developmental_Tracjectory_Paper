# Install and Load Libraries 
install.packages("car")
install.packages("sm")
install.packages("ggplot2") # for general plots
install.packages("MASS") # for polr package
install.packages("generalhoslem") # for testing model fit (lipsitz test and two others)
install.packages("qwraps2") # for summary_table use
install.packages("quantreg") # testing quantile plots (geom_quantile) and quantile regressions
install.packages ("olsrr") #for testing normality
install.packages("plyr") #for count and other cool things
install.packages("psych") #obtain descriptive statistics
install.packages("colorspace") # for fixing colors in plots
install.packages("stargazer") # for pretty regression output tables
install.packages("MASS") # for polr package
install.packages("generalhoslem") # for testing model fit 
install.packages("qwraps2") # for summary_table use
install.packages("quantreg") # testing quantile plots (geom_quantile) and quantile regressions
install.packages("sure") # package for calculating residuals for ordinal logistic regression (https://journal.r-project.org/archive/2018/RJ-2018-004/RJ-2018-004.pdf)
install.packages("mediation") # package for testing mediation effects
install.packages("gridExtra")
install.packages(“coin”)
install.packages("dplyr")
install.packages("tidyr")
        

library(car)
library(sm)
library(ggplot2) 
library(MASS) 
library(generalhoslem) 
library(qwraps2) 
library(quantreg) 
library(olsrr)
library(plyr)
library(psych)
library(colorspace) 
library(stargazer)
library(MASS)
library(generalhoslem) 
library(qwraps2) 
library(quantreg) 
library(sure) 
library(mediation) 
library(gridExtra)
library(coin)
library(dplyr)
library(tidyr)

# Check and Set Working Directory
      setwd("~/Desktop")
      getwd()
      
# Import Data [[make sure is most recent version and saved as csv]]
      Map <- read.csv("Mapping_Coding_KW_200401.csv", na.strings = "N/A")
      View(Map)
      # <- saves MC as an object, read.csv() imports it    
  
 # Participants

      Map_EE <- subset(Map, Map$Group_4cat == "English Early" & (Map$Age_Rounded>=5 & Map$Age_Rounded<10 | is.na(Map$Age_Rounded)))
      View(Map_EE) #50 total English Early kids within our age range (5-9)

      Total_Inc_Study <- subset(Map_EE, Map_EE$Including.in.Study == "Yes" & Map_EE$Mapping_Include. == "Yes")
      View(Total_Inc_Study)# 47 total kids included in study

      Total_Not_Inc_Study <- subset(Map_EE, Map_EE$Including.in.Study == "No" | Map_EE$Including.in.Study== "")
      nrow(Total_Not_Inc_Study)# 3 total kids not included in study

      Total_Blank_NA <- subset(Map_EE, Map_EE$Including.in.Study == "" | is.na(Map_EE$Including.in.Study))
      nrow(Total_Blank_NA) # 0 blanks or N/As

      Tested_Not_Inc <- subset(Map_EE, Map_EE$Including.in.Study != "Yes" & Map_EE$Date.Tested != "")
      nrow(Tested_Not_Inc)
      # 0 kids not included in study that were tested. 
      
       # Find observations with missing Age and SES values
            which(is.na(Total_Inc_Study$Age_Rounded)) # 0 observations missing Age value
            Missing_Age <- Total_Inc_Study[which(is.na(Total_Inc_Study$Age_Rounded)),3]
            nrow(Missing_Age)

            which(is.na(Total_Inc_Study$SES)) # 0 observations missing SES value
            Missing_SES <- Total_Inc_Study[which(is.na(Total_Inc_Study$SES)),3]
            nrow(Missing_SES)

            Incorrect_SES <- subset(Total_Inc_Study, Total_Inc_Study$SES < 3  & Total_Inc_Study$SES < 66 | Total_Inc_Study$SES_range_8_to_66 == "")
            nrow(Incorrect_SES) #No observations of SES < 3 or > 66
                   
        # SEX 
        sum(Total_Inc_Study$M.F=='Female') # 24
        sum(Total_Inc_Study$M.F=='Male') # 23
        sum(Total_Inc_Study$M.F=='N/A') # 0

        # RACE & ETHNICITY DESCRIPTIVE STATISTICS, grouped Unsure and N/As together
         count((Total_Inc_Study$Race)) #40 white, 3 mixed, 1 american indian/alaska native, 1 other, 1 unsure, 1 N/A
        count((Total_Inc_Study$Ethnicity)) #36 not hispanic or latino, 4 hispanic or latino, 6 N/A, 1 unsure

        # AGE DESCRIPTIVE STATISTICS    
        min(Total_Inc_Study$Age_Rounded, na.rm=TRUE) # 5.1
        max(Total_Inc_Study$Age_Rounded, na.rm=TRUE) # 9.7
        median(Total_Inc_Study$Age_Rounded, na.rm=TRUE) # 6.7
        mean(Total_Inc_Study$Age_Rounded, na.rm=TRUE) # 6.917021
        sd(Total_Inc_Study$Age_Rounded, na.rm=TRUE) # 1.304394
        range(Total_Inc_Study$Age_Rounded, na.rm=TRUE) # 5.1 - 9.7
        ggplot(Total_Inc_Study, aes(x=Group_4cat, y=Age_Rounded)) + geom_violin()

        # SES DESCRIPTIVE STATISTICS
        min(Total_Inc_Study$SES, na.rm=TRUE) # 17
        max(Total_Inc_Study$SES, na.rm=TRUE) # 66
        median(Total_Inc_Study$SES, na.rm=TRUE) # 61
        mean(Total_Inc_Study$SES, na.rm=TRUE) # 56.20213
        sd(Total_Inc_Study$SES, na.rm=TRUE) # 12.37005
        range(Total_Inc_Study$SES, na.rm=TRUE) # 17 - 66
        ggplot(Total_Inc_Study, aes(x=Group_4cat, y=SES)) + geom_violin()
            # Skewness and Kurtosis for SES 
                  describe(Total_Inc_Study$SES) #using Psych package, skewness -1.99 & SE 1.8
                  qplot(Total_Inc_Study$SES, geom = 'histogram', binwidth = 2) + xlab('SES') #highly skewed 

#Data Analysis
        Map_HBE <- subset(Map_EE, Map_EE$Including.in.Study == "Yes" & Map_EE$Mapping_Include. == "Yes") #RENAMING Total_Inc_Study DATA FRAME for coding ease
        View(Map_HBE)

